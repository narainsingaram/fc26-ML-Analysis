<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FC26 Rating Engine</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
</head>
<body>
  <header>
    <h1>
      <span class="text-gradient">‚ñ≤ FC26</span> Rating Engine
    </h1>
    <div class="muted small">
      Next-Gen Player Analysis & Forecasting
    </div>
  </header>

  <main>
    <!-- Top Grid: Selection & Comparison -->
    <div class="grid">
      <!-- Player Selection -->
      <div class="col-span-4 card">
        <h2 style="font-size: 1.1rem; margin-bottom: 0.5rem;">Select Players</h2>
        <div class="muted small" style="margin-bottom: 1rem;">Pick up to 4 players. First two are compared.</div>
        
        <input id="search" type="text" placeholder="Search by name..." style="margin-bottom: 1rem;" />
        
        <div id="selectedChips" style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 1rem; min-height: 32px;"></div>
        
        <div id="playerList"></div>
        
        <div style="margin-top: 1.5rem;">
          <button class="btn" id="compareBtn" style="width: 100%;">Analyze Selection</button>
          <div class="error" id="error" style="color: var(--negative); font-size: 0.875rem; margin-top: 0.5rem;"></div>
        </div>
      </div>

      <!-- Main Comparison Display -->
      <div class="col-span-8 card primary">
        <div style="display: flex; justify-content: space-between; margin-bottom: 1.5rem;">
           <span class="tiny muted" style="letter-spacing: 0.1em;">TIER 1 ‚Äî DECISION INTELLIGENCE</span>
           <div class="chip-group" id="insightPills" style="display:flex; gap: 8px;"></div>
        </div>
        
        <div class="hero-versus">
          <div class="hero-card" id="heroCardA">
            <div class="tiny muted" style="margin-bottom: 0.5rem;">Base / Anchor</div>
            <img id="cardA" alt="" src="" style="min-height: 200px; background: rgba(0,0,0,0.2); border-radius: 8px;" />
            <div style="margin-top: 1rem;">
              <div id="heroAName" style="font-weight: 800; font-size: 1.1rem;">‚Äî</div>
              <div id="heroAVal" class="text-gradient" style="font-size: 0.9rem;">‚Äî</div>
            </div>
          </div>

          <div class="stat-delta">
            <div class="tiny muted" style="margin-bottom: 4px;">Delta</div>
            <div id="heroDelta" class="value">‚Äî</div>
            <div id="heroDeltaLabel" class="tiny muted" style="margin-top: 4px;">‚Äî</div>
          </div>

          <div class="hero-card" id="heroCardB">
            <div class="tiny muted" style="margin-bottom: 0.5rem;">Target / Challenger</div>
            <img id="cardB" alt="" src="" style="min-height: 200px; background: rgba(0,0,0,0.2); border-radius: 8px;" />
            <div style="margin-top: 1rem;">
              <div id="heroBName" style="font-weight: 800; font-size: 1.1rem;">‚Äî</div>
              <div id="heroBVal" class="text-gradient" style="font-size: 0.9rem;">‚Äî</div>
            </div>
          </div>
        </div>

        <div id="reasoning" class="muted small" style="text-align: center; margin-top: 1.5rem; padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 8px;">
          Select players to generate natural language analysis.
        </div>

        <div id="extraComparisons" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem;"></div>
      </div>
    </div>

    <!-- Tier 2: Drivers & Quantiles -->
    <div class="grid">
      <div class="col-span-8 card">
        <h3 style="margin-bottom: 0.25rem;">Feature Attribution (SHAP)</h3>
        <div class="muted small" style="margin-bottom: 1rem;">Which attributes drive the difference?</div>
        <div id="driversChart" style="width: 100%; height: 320px;"></div>
      </div>

      <div class="col-span-4 card">
        <h3 style="margin-bottom: 0.25rem;">Quantile Forecast</h3>
        <div class="muted small" style="margin-bottom: 1rem;">Uncertainty & Ceiling Analysis</div>
        <div id="quantCard" style="margin-top: 2rem;">
          <div class="muted small">Run comparison to view quantile ranges.</div>
        </div>
      </div>
    </div>

    <!-- Tier 3: Exploration -->
    <details open>
      <summary>
        <span>üß† Tier 3 ‚Äî Deep Exploration</span>
      </summary>
      <div class="details-content grid">
        <div class="col-span-6 card">
          <h3 style="margin-bottom: 0.25rem;">Dynamic What-If</h3>
          <div class="muted small" style="margin-bottom: 1rem;">Adjust Target Player stats to see OVR impact</div>
          <div id="whatIfContainer"></div>
        </div>
        
        <div class="col-span-6 card">
            <h3 style="margin-bottom: 0.25rem;">Similar Players</h3>
            <div class="muted small" style="margin-bottom: 1rem;">Find statistically similar profiles</div>
            <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
              <button class="btn secondary" id="similarBtn" style="width: auto;">Find Similar</button>
              <div class="error" id="similarError" style="align-self: center;"></div>
            </div>
            <div id="similarGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 0.75rem;"></div>
        </div>
      </div>
    </details>

    <details>
      <summary>
         <span>üåê Visuals & Causal Inference</span>
      </summary>
      <div class="details-content grid">
        <div class="col-span-6 card">
          <h3 style="margin-bottom: 1rem;">Similarity Network</h3>
          <div id="network" style="width: 100%; height: 400px;"></div>
        </div>
        <div class="col-span-6 card">
          <h3 style="margin-bottom: 1rem;">Attribute Radar</h3>
          <div id="radar3d" style="width: 100%; height: 400px;"></div>
        </div>
        
        <div class="col-span-12 card">
            <h3 style="margin-bottom: 1rem;">Global Causal Effects</h3>
            <div style="overflow-x: auto;">
              <table class="table-premium">
                <thead>
                  <tr>
                    <th>Feature</th>
                    <th>Œî OVR per +1</th>
                    <th>Œî OVR per +5</th>
                  </tr>
                </thead>
                <tbody id="causalBody"></tbody>
              </table>
            </div>
        </div>
      </div>
    </details>

    <details open>
      <summary>
        <span>üö® Market Anomalies</span>
      </summary>
      <div class="details-content card">
        <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-bottom: 1.5rem; align-items: end;">
            <div style="flex: 1; min-width: 140px;">
                <label class="muted small" style="display:block; margin-bottom:6px;">Type</label>
                <select id="anomKind">
                    <option value="underrated">Underrated (Hidden Gems)</option>
                    <option value="overrated">Overrated</option>
                </select>
            </div>
            <div style="flex: 1; min-width: 100px;">
                <label class="muted small" style="display:block; margin-bottom:6px;">Pos</label>
                <input id="anomPos" type="text" placeholder="e.g. ST" />
            </div>
            <div style="flex: 1; min-width: 140px;">
                <label class="muted small" style="display:block; margin-bottom:6px;">League</label>
                <input id="anomLeague" type="text" placeholder="League Name" />
            </div>
            <div style="flex: 1; min-width: 80px;">
                 <label class="muted small" style="display:block; margin-bottom:6px;">Max Age</label>
                <input id="anomAge" type="number" placeholder="23" />
            </div>
            <button class="btn" id="anomBtn" style="height: 46px;">Find Anomalies</button>
            <div class="error" id="anomError"></div>
        </div>

        <div style="display: flex; gap: 2rem; flex-wrap: wrap;">
            <div id="anomList" style="flex: 1; min-width: 300px; display: grid; gap: 0.75rem; grid-auto-rows: max-content;"></div>
            <div id="anomScatter" style="flex: 1; min-width: 300px; height: 400px; border: 1px solid var(--panel-border); border-radius: var(--radius-md);"></div>
        </div>
      </div>
    </details>

  </main>
  
  <script src="script.js"></script>
</body>
</html>
